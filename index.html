<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="style.css" rel="stylesheet">
</head>
<body onload="iniciarSistema()">

    <div id="tela-manutencao" class="maintenance-overlay hidden">
        <i class="fa-solid fa-triangle-exclamation" style="font-size:5rem; color:#f59e0b; margin-bottom:20px; animation: pulse 2s infinite;"></i>
        <h1 style="font-size:2.5rem; margin-bottom:15px; font-weight:800;">Sistema em Manuten√ß√£o</h1>
        <p style="color:#94a3b8; font-size:1.1rem; max-width: 500px; line-height: 1.6;">Nossa plataforma est√° passando por atualiza√ß√µes neste exato momento para melhorar a sua experi√™ncia e trazer novas funcionalidades. Voltaremos em breve!</p>
    </div>

    <div id="login-parceiro-wrap" class="login-wrap modern-login-bg hidden">
        <div class="login-card modern-card">
            <div class="login-icon-wrapper">
                <i class="fa-solid fa-store"></i>
            </div>
            <h2>√Årea do Parceiro</h2>
            <p class="login-subtitle">Gerencie suas vendas e card√°pio</p>
            <form onsubmit="loginParceiro(event)">
                <div class="input-group">
                    <label>Usu√°rio</label>
                    <div class="input-icon-wrap">
                        <i class="fa-solid fa-user"></i>
                        <input type="text" id="parceiro-user" placeholder="Digite seu login">
                    </div>
                </div>
                <div class="input-group">
                    <label>Senha</label>
                    <div class="input-icon-wrap">
                        <i class="fa-solid fa-lock"></i>
                        <input type="password" id="parceiro-pass" placeholder="Sua senha">
                    </div>
                </div>
                <button type="submit" class="btn-login modern-btn">ACESSAR SISTEMA</button>
            </form>
        </div>
    </div>

    <div id="app-parceiro" class="app-container hidden">
        
        <div class="mobile-top-header">
            <h1 id="page-title-mob">Vis√£o Geral</h1>
            
            <div class="status-loja-btn" onclick="toggleStatusLoja()">
                <div id="status-indicator-mob" class="status-dot"></div>
                <span id="status-text-mob">Aberto</span>
            </div>

            <button class="btn-mais-mobile" onclick="toggleMenuExtra()">
                <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>
        </div>

        <div id="extra-menu-mob" class="extra-menu-mobile">
            <button onclick="nav('config'); toggleMenuExtra()" class="btn-login" style="background:#3b82f6; margin-bottom:10px;">
                <i class="fa-solid fa-store"></i> Minha Loja
            </button>
            <button onclick="abrirQRCode(); toggleMenuExtra()" class="btn-login" style="background:#2d3436; margin-bottom:10px;">
                <i class="fa-solid fa-qrcode"></i> Ver QR Code
            </button>
            <button onclick="abrirCardapioMobile(); toggleMenuExtra()" class="btn-login" style="background:#f59e0b; margin-bottom:10px;">
                <i class="fa-solid fa-mobile-screen"></i> Ver Card√°pio
            </button>
            <div class="nav-item btn-logout-nav" onclick="logout()" style="justify-content:flex-start">
                <i class="fa-solid fa-power-off"></i> Sair
            </div>
        </div>

        <aside class="sidebar" id="main-nav">
            <div class="brand">
                <i class="fa-solid fa-utensils"></i> <span id="sys-nome-rest">Minha Loja</span>
            </div>
            
            <div class="status-loja-container" onclick="toggleStatusLoja()">
                <div id="status-indicator-desk" class="status-dot"></div>
                <span id="status-text-desk" style="font-weight: 700;">Aberto para Pedidos</span>
            </div>
            
            <div id="nav-dash" class="nav-item active" onclick="nav('dash')">
                <i class="fa-solid fa-chart-pie"></i> <span>Resumo</span>
            </div>
            <div id="nav-caixa" class="nav-item" onclick="nav('caixa')">
                <i class="fa-solid fa-cash-register"></i> <span>Caixa</span>
            </div>
            <div id="nav-prods" class="nav-item" onclick="nav('prods')">
                <i class="fa-solid fa-burger"></i> <span>Menu</span>
            </div>
            <div id="nav-financeiro" class="nav-item" onclick="nav('financeiro')">
                <i class="fa-solid fa-sack-dollar"></i> <span>Finan√ßas</span>
            </div>
            <div id="nav-historico" class="nav-item" onclick="nav('historico')">
                <i class="fa-solid fa-clock-rotate-left"></i> <span>Hist√≥rico</span>
            </div>
            
            <div id="nav-config" class="nav-item" onclick="nav('config')">
                <i class="fa-solid fa-store"></i> <span>Minha Loja</span>
            </div>
            
            <div style="margin-top:20px;">
                <button onclick="abrirQRCode()" class="btn-login" style="background:#2d3436; font-size:0.9rem; margin-bottom:10px;">
                    <i class="fa-solid fa-qrcode"></i> QR Code
                </button>
                <button onclick="abrirCardapioMobile()" class="btn-login" style="background:#f59e0b; font-size:0.9rem;">
                    <i class="fa-solid fa-mobile-screen"></i> Mobile
                </button>
            </div>
            
            <div style="margin-top:auto">
                <div class="nav-item btn-logout-nav" onclick="logout()">
                    <i class="fa-solid fa-power-off"></i> Sair do Sistema
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="header">
                <h1 id="page-title">Dashboard</h1> 
                <div id="header-actions"></div>
            </header>
            
            <div id="content-area"></div>
            
            <footer id="sys-footer" class="app-footer hidden"></footer>
        </main>
    </div>

    <div id="modal-despesas" class="modal-overlay hidden">
        <div class="modal-box" style="width: 500px;">
            <div class="modal-header">
                <h2>Lan√ßar Despesas do M√™s</h2>
                <button class="close-modal" onclick="fecharModalDespesas()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form onsubmit="salvarDespesa(event)" style="background:#f8fafc; padding:15px; border-radius:12px; border:1px solid var(--border); margin-bottom:20px;">
                <div class="form-grid">
                    <div class="input-group">
                        <label>Categoria</label>
                        <select id="desp-cat" required>
                            <option value="Aluguel">Aluguel do Ponto</option>
                            <option value="Energia El√©trica">Energia El√©trica</option>
                            <option value="√Ågua">Conta de √Ågua</option>
                            <option value="G√°s">G√°s de Cozinha</option>
                            <option value="Funcion√°rios">Pagamento de Funcion√°rios</option>
                            <option value="Marketing">Marketing / An√∫ncios</option>
                            <option value="Outros">Outros Custos</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="desp-valor" step="0.01" required placeholder="Ex: 1500,00">
                    </div>
                </div>
                <div class="input-group">
                    <label>Descri√ß√£o Opcional</label>
                    <input type="text" id="desp-desc" placeholder="Ex: Conta de Luz de Agosto">
                </div>
                <button type="submit" class="btn-primary" style="width:100%; justify-content:center;"><i class="fa-solid fa-plus"></i> Registrar Despesa</button>
            </form>
            <h3 style="font-size:1rem; margin-bottom:10px; color:var(--text-main);">Gastos Registrados neste m√™s</h3>
            <div id="lista-despesas-mes" style="max-height: 250px; overflow-y:auto; border:1px solid var(--border); border-radius:8px;"></div>
        </div>
    </div>

    <div id="modal-produto" class="modal-overlay hidden">
        <div class="modal-box" style="width: 500px;">
            <div class="modal-header">
                <h2 id="modal-prod-titulo">Novo Produto</h2>
                <button class="close-modal" onclick="fecharModalProduto()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form onsubmit="salvarProduto(event)">
                <input type="hidden" id="prod-id">
                <div class="switch-container">
                    <label class="switch-label">Pausar Venda (Ocultar do Card√°pio e Comanda)</label>
                    <label class="switch"><input type="checkbox" id="prod-pausado"><span class="slider"></span></label>
                </div>
                <div class="input-group"><label>Nome do Item</label><input type="text" id="prod-nome" required></div>
                <div class="form-grid">
                    <div class="input-group"><label>Custo Interno (R$)</label><input type="number" id="prod-custo" step="0.01" placeholder="Ex: 5,00"></div>
                    <div class="input-group"><label>Pre√ßo de Venda (R$)</label><input type="number" id="prod-preco" step="0.01" required placeholder="Ex: 15,00"></div>
                </div>
                <div class="input-group"><label>Descri√ß√£o (Ingredientes, Detalhes...)</label><textarea id="prod-desc" rows="2" placeholder="Essa descri√ß√£o aparece para o cliente."></textarea></div>
                <div class="form-grid">
                    <div class="input-group">
                        <label>Categoria</label>
                        <select id="prod-cat" required>
                            <option value="Destaques">Destaques</option>
                            <option value="Lanches">Lanches</option>
                            <option value="Bebidas">Bebidas</option>
                            <option value="Pizzas">Pizzas</option>
                            <option value="Por√ß√µes">Por√ß√µes</option>
                            <option value="Sobremesas">Sobremesas</option>
                            <option value="Almo√ßo">Almo√ßo</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="input-group"><label>Imagem URL</label><input type="text" id="prod-img"></div>
                </div>
                <button type="submit" class="btn-login" style="margin-top: 10px;">Salvar Produto</button>
            </form>
        </div>
    </div>

    <div id="modal-promo" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h2>Criar Promo√ß√£o</h2>
                <button class="close-modal" onclick="document.getElementById('modal-promo').classList.add('hidden')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form onsubmit="salvarPromocao(event)">
                <div style="background: #eff6ff; padding: 10px; border-radius: 8px; border: 1px solid #bfdbfe; color: #1e3a8a; font-size: 0.85rem; margin-bottom: 15px;">
                    <i class="fa-solid fa-circle-info"></i> O produto original selecionado abaixo ser√° <b>movido para os Itens Pausados automaticamente</b> enquanto esta promo√ß√£o existir.
                </div>
                <label style="font-size:0.9rem; font-weight:600; margin-bottom:5px; display:block">Selecione o Produto Base:</label>
                <div id="grid-promo-items" class="selection-grid"></div>
                <input type="hidden" id="selected-promo-id" required>
                <div class="form-grid">
                    <div class="input-group"><label>Novo Pre√ßo Promocional (R$)</label><input type="number" id="promo-preco" step="0.01" required></div>
                    <div class="input-group"><label style="color:#b91c1c;">V√°lido at√© (Opcional)</label><input type="datetime-local" id="promo-validade" style="border-color:#fca5a5; background:#fef2f2;"></div>
                </div>
                <button type="submit" class="btn-login">Criar Promo√ß√£o</button>
            </form>
        </div>
    </div>

    <div id="modal-combo" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h2>Criar Combo</h2>
                <button class="close-modal" onclick="document.getElementById('modal-combo').classList.add('hidden')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form onsubmit="salvarCombo(event)">
                <div class="input-group"><label>Nome do Combo</label><input type="text" id="combo-nome" required></div>
                <label style="font-size:0.9rem; font-weight:600; margin-bottom:5px; display:block">Selecione os Itens:</label>
                <div id="grid-combo-items" class="selection-grid"></div>
                <div class="form-grid">
                    <div class="input-group"><label>Pre√ßo Total (R$)</label><input type="number" id="combo-preco" step="0.01" required></div>
                    <div class="input-group"><label style="color:#b91c1c;">V√°lido at√© (Opcional)</label><input type="datetime-local" id="combo-validade" style="border-color:#fca5a5; background:#fef2f2;"></div>
                </div>
                <div class="input-group"><label>Imagem do Combo URL</label><input type="text" id="combo-img"></div>
                <button type="submit" class="btn-login">Criar Combo</button>
            </form>
        </div>
    </div>
    
    <div id="modal-taxas" class="modal-overlay hidden">
        <div class="modal-box" style="width: 400px;">
            <div class="modal-header">
                <h2>Configurar Taxas de Cart√£o</h2>
                <button class="close-modal" onclick="fecharModalTaxas()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div style="margin-bottom: 20px; color: var(--text-muted); font-size: 0.9rem;">Defina a porcentagem (%) descontada pela sua maquininha. O sistema calcular√° o faturamento l√≠quido automaticamente.</div>
            <div class="input-group"><label>Taxa de Cr√©dito (%)</label><input type="number" id="input-taxa-credito" step="0.01" placeholder="Ex: 3.5"></div>
            <div class="input-group"><label>Taxa de D√©bito (%)</label><input type="number" id="input-taxa-debito" step="0.01" placeholder="Ex: 1.5"></div>
            <button class="btn-primary" style="width: 100%; justify-content: center;" onclick="salvarTaxasCartao()">Salvar Configura√ß√µes</button>
        </div>
    </div>

    <div id="modal-pagamento" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h2>Pagamento</h2>
                <button class="close-modal" onclick="fecharPagamento()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="pdv-total" id="pag-total" style="text-align:center; margin-bottom:20px;">R$ 0.00</div>
            <div class="payment-grid">
                <div class="pay-btn" onclick="selecionarPagamento('dinheiro', this)"><i class="fa-solid fa-money-bill-wave"></i> Dinheiro</div>
                <div class="pay-btn" onclick="selecionarPagamento('pix', this)"><i class="fa-brands fa-pix"></i> Pix</div>
                <div class="pay-btn" onclick="selecionarPagamento('credito', this)"><i class="fa-solid fa-credit-card"></i> Cr√©dito</div>
                <div class="pay-btn" onclick="selecionarPagamento('debito', this)"><i class="fa-solid fa-credit-card"></i> D√©bito</div>
            </div>
            <div id="area-troco" class="troco-box hidden">
                <div class="input-group"><label>Valor Recebido (R$)</label><input type="number" id="valor-recebido" onkeyup="calcularTroco()"></div>
                <div style="font-weight:700; color:var(--text-main)">Troco: <span id="valor-troco">R$ 0.00</span></div>
            </div>
            <button class="btn-login" style="background:var(--success); margin-top:20px;" onclick="concluirPagamento()">CONFIRMAR PAGAMENTO</button>
        </div>
    </div>
    
    <div id="modal-pdv" class="modal-overlay hidden">
        <div class="modal-box" style="max-width:900px">
            <div class="modal-header">
                <h2 id="pdv-titulo">PDV</h2>
                <button class="close-modal" onclick="fecharPDV()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-pdv-content">
                <div class="pdv-left">
                    <input type="text" id="search-pdv" class="search-bar" placeholder="üîç Buscar Produto (Pausados n√£o aparecem aqui)" onkeyup="renderPDVProdutos(this.value)">
                    <div class="pdv-produtos" id="pdv-lista-prods"></div>
                </div>
                <div class="pdv-cart">
                    <div class="receipt-box">
                        <div class="receipt-header"><span>CARRINHO</span></div>
                        <div class="cart-list" id="pdv-carrinho"></div>
                        <div class="receipt-footer">
                            <div id="box-10pct" class="hidden">
                                <div class="taxa-line">
                                    <span style="font-weight:600; color:#555;">Taxa de Servi√ßo (10%)</span>
                                    <label class="switch"><input type="checkbox" id="pdv-10pct" onchange="atualizarTotalPDV()"><span class="slider"></span></label>
                                </div>
                            </div>
                            <div id="box-entrega" class="hidden" style="margin-bottom:15px;">
                                <div class="input-taxa-wrapper">
                                    <span style="font-weight:600; color:#555; white-space:nowrap;">Entrega:</span>
                                    <div class="input-taxa-group">
                                        <i class="fa-solid fa-motorcycle"></i>
                                        <input type="number" id="pdv-entrega" value="0" placeholder="0,00" onchange="atualizarTotalPDV()">
                                    </div>
                                </div>
                            </div>
                            <div class="pdv-total" id="pdv-total-valor">R$ 0.00</div>
                            <div class="pdv-actions-grid">
                                <button class="btn-comanda" style="background:#64748b;" onclick="salvarComanda()">Salvar</button>
                                <button class="btn-comanda" style="background:#f59e0b;" onclick="imprimirConta()">Conta</button>
                                <button class="btn-comanda" style="background:#ef4444;" onclick="cancelarPedido()">Cancelar</button>
                                <button class="btn-comanda" style="background:#10b981;" onclick="abrirPagamento()">Pagamento</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="modal-qrcode" class="modal-overlay hidden">
        <div class="modal-box" style="width:400px; text-align:center;">
            <div class="modal-header">
                <h2 style="font-weight:800; font-size:1.5rem; color:var(--text-main);">QR Code da Loja</h2>
                <button class="close-modal" onclick="fecharQRCode()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="qr-container" style="background:#f8fafc; padding:20px; border-radius:12px; border:1px solid var(--border); margin-bottom:20px;">
                <img id="qr-image" src="" style="width:200px; height:200px; padding:10px; background:white; border-radius:12px; box-shadow:var(--shadow-sm); margin:0 auto 15px auto; display:block;">
                <p style="font-size:0.95rem; color:var(--text-muted); margin-bottom:20px; line-height:1.5;">Aponte a c√¢mera do celular para este c√≥digo ou clique no bot√£o abaixo para testar o card√°pio.</p>
                <a id="qr-link" href="#" target="_blank" class="btn-primary" style="width:100%; display:flex; justify-content:center; text-decoration:none; padding:15px; font-size:1rem;">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> Acessar Card√°pio Digital
                </a>
            </div>
            <button onclick="imprimirDisplayQR()" class="btn-login" style="background:#f59e0b; width: 100%; justify-content: center; display:flex; align-items:center; gap:10px; padding:15px; font-size:1.1rem;">
                <i class="fa-solid fa-print"></i> Imprimir Display de Mesa
            </button>
        </div>
    </div>
    
    <div id="mobile-overlay" class="ifood-wrapper hidden">
        <div class="ifood-header">
            <button class="btn-back-sys" id="btn-back-sys" onclick="fecharCardapioMobile()"><i class="fa-solid fa-arrow-left"></i> Voltar</button>
            <div class="ifood-cover" style="background-image: url('https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=800');"></div>
            <div class="ifood-rest-info">
                <img id="mob-logo" src="" class="ifood-logo">
                <h2 id="mob-title">Restaurante</h2>
                <div class="ifood-rest-stats">
                    <span><i class="fa-solid fa-star" style="color:#f59e0b;"></i> 4.9</span>
                    <span><i class="fa-solid fa-clock"></i> 30-40 min</span>
                    <span id="ifood-status-loja" style="color:var(--success); font-weight:600;">Aberto</span>
                </div>
            </div>
        </div>
        
        <div class="ifood-search-container">
            <div class="ifood-search-bar"><i class="fa-solid fa-magnifying-glass"></i> O que voc√™ quer pedir hoje?</div>
        </div>
        
        <div class="ifood-categories-wrapper">
            <div class="ifood-cat-scroll" id="mob-categorias"></div>
        </div>

        <div class="ifood-body" id="mob-body-items"></div>

        <div id="floating-cart" class="ifood-floating-cart hidden" onclick="abrirSacolaCliente()">
            <div class="cart-left"><i class="fa-solid fa-shopping-bag"></i> <span id="cart-qtd">0</span></div>
            <div class="cart-center">Ver sacola</div>
            <div class="cart-right" id="cart-total">R$ 0.00</div>
        </div>
    </div>

    <div id="modal-sacola" class="modal-overlay hidden" style="z-index: 10005;">
        <div class="modal-box ifood-sacola-box">
            <div class="modal-header" style="border-bottom:none; padding-bottom:0;">
                <h2 style="font-weight:700; font-size:1.3rem;">Sua Sacola</h2>
                <button class="close-modal" style="background:transparent; color:#3f3e3e; font-size:1.5rem;" onclick="fecharSacolaCliente()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div id="sacola-lista" class="ifood-sacola-lista"></div>
            <div class="ifood-checkout-area">
                <div class="input-group"><label>Seu Nome</label><input type="text" id="cliente-nome" placeholder="Como devemos te chamar?" style="background:#f7f7f7; border:none;"></div>
                <div class="input-group">
                    <label>Onde voc√™ est√°?</label>
                    <select id="cliente-tipo-pedido" onchange="toggleMesaInput()" style="background:#f7f7f7; border:none;">
                        <option value="delivery">Delivery (Entregar no meu endere√ßo)</option>
                        <option value="mesa">Estou em uma Mesa no local</option>
                    </select>
                </div>
                <div class="input-group" id="div-endereco-delivery">
                    <label>Seu Endere√ßo / Localiza√ß√£o</label>
                    <input type="text" id="cliente-endereco" placeholder="Rua, N√∫mero, Bairro, Complemento..." style="background:#f7f7f7; border:none;">
                </div>
                <div class="input-group hidden" id="div-numero-mesa">
                    <label>N√∫mero da Mesa</label>
                    <input type="number" id="cliente-numero-mesa" placeholder="Ex: 5" style="background:#f7f7f7; border:none;">
                </div>
                <div class="ifood-sacola-total"><span>Total a pagar</span><span id="sacola-total-valor">R$ 0.00</span></div>
                <button class="btn-login ifood-btn-checkout" onclick="enviarPedidoCliente()">Confirmar Pedido</button>
            </div>
        </div>
    </div>
    
    <div id="print-area"></div>
    <script src="script.js"></script>
</body>
</html>